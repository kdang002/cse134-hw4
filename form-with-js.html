<!doctype html>
<html lang="en">

    <!-- HEAD BEGINS -->
	<head>
		<meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

		<title>CSE 134B - VyDang</title>

        <link rel="stylesheet" href="main.css" media="screen">
        <link rel="icon" type="image/x-icon" href="resources\images\vkd.ico">

        <!-- Importing Custom Porsche fonts directly from porsche.com -->
        <link rel="preconnect" href="https://cdn.ui.porsche.com" crossorigin>
        <link rel="dns-prefetch" href="https://cdn.ui.porsche.com" crossorigin>
                
	</head>

    <body>
		<header class="navbar">
            <!-- Pure CSS Hamburger Menu (Mobile Only) -->
            <input type="checkbox" id="menu-toggle" aria-label="Toggle mobile menu">
            <label for="menu-toggle" class="hamburger-label" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </label>

            <!-- Desktop Dropdown Menu -->
            <nav class="dropdown">
                <button type="button" class="dropbtn">Menu</button>
                <section class="dropdown-content">
                    <a href="about-me.html">About Me</a>
                    <a href="hobby.html">My Hobby</a>
                </section>
            </nav>

            <a href="index.html" class="logo-link">
                <h1 class="logo">Vy Kiet Dang</h1>
            </a>
            <button id="theme-toggle">Dark Mode</button>

            <!-- Mobile Menu (Controlled by CSS) -->
            <nav class="mobile-menu">
                <a href="about-me.html">About Me</a>
                <a href="hobby.html">My Hobby</a>
            </nav>
		</header>

        <main>
            <h1>Contact Us</h1>
            <form id="contactForm" action="https://httpbin.org/post" method="POST" novalidate>
                <fieldset>
                    <legend>Fill in Your Info</legend>

                    <!-- Hidden field to detect bots -->
                    <input type="hidden" name="possible_bot" value="true">

                    <!-- NAME ; '*' inside of span aria-hidden="true" so that screen reader's won't annount it -->
                    <label for="name">Full Name <span aria-hidden="true">*</span></label>
                    <input type="text" id="name" name="name" 
                    pattern="[A-Za-z\s]+" maxlength="50" required
                    placeholder="Your full name"
                    title="Alphabet characters only, up to 50 characters.">
                    <output class="error" id="name-error"></output>

                    <!-- EMAIL -->
                    <label for="email">Email Address <span aria-hidden="true">*</span></label>
                    <input type="email" id="email" name="email"
                        placeholder="example@domain.com" required>
                    <output class="error" id="email-error"></output>

                    <!-- SUBJECT -->
                    <label for="subject">Subject <span aria-hidden="true">*</span></label>
                    <input type="text" id="subject" name="subject"
                        pattern="[A-Za-z0-9\s.,!?'\-]+"
                        maxlength="80"
                        required
                        placeholder="What's this about?">
                    <output class="error" id="subject-error"></output>

                    <!-- COMMENTS -->
                    <label for="comments">Comments</label>
                    <textarea id="comments" name="comments"
                            rows="5" maxlength="250"
                            placeholder="Up to 250 characters."></textarea>
                    <output class="info" id="comment-info" ></output>

                    <!-- CONTACT METHOD -->
                    <label for="contact-method">Preferred Contact Method <span aria-hidden="true">*</span></label>
                    <select id="contact-method" name="contact_method" placeholder="Select One" required>
                        <option value="email">Email</option>
                        <option value="phone">Phone</option>
                    </select>
                    <output class="error" id="contact-method-error"></output>

                    <!-- PHONE  -->
                    <label for="phone">Phone (optional)</label>
                    <input type="tel" id="phone" name="phone"
                        pattern="[0-9]{10}"
                        placeholder="1234567890"
                        title="Enter a 10-digit number (digits only).">
                    <output class="error" id="phone-error"></output>

                    <!-- Custom message area -->
                    <output id="info" name="info"></output>


                    <div class="button-group">
                        <button type="submit">Submit</button>
                        <button type="reset">Reset</button>
                    </div>
                </fieldset>
            </form>
        </main>

        <!-- FOOTER BEGINS -->
		<footer>
			<div>
                <p>&copy; <span id="year"></span> Vy Kiet Dang. All rights reserved.</p>
			</div>
		</footer>
        <!-- FOOTER ENDS -->

        <!-- ===========================
            SCRIPT
        ===========================  -->
        <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ----------------------------------------------------            
            // SET YEAR FOOTER
            // ----------------------------------------------------            
            document.getElementById('year').textContent = new Date().getFullYear();

            const form = document.getElementById('contactForm');
            if (!form) return; // If the form cannot be found, just return. 

            // ----------------------------------------------------
            // FORM VALIDATIONS & HANDLING
            // ----------------------------------------------------            
            // Form fields value
            const fields = [
            { id: 'name', pattern: /^[A-Za-z\s]+$/, message: 'Only letters and spaces allowed.' },
            { id: 'email', pattern: /^[^@\s]+@[^@\s]+\.[^@\s]+$/, message: 'Enter a valid email address.' },
            { id: 'subject', pattern: /^[A-Za-z0-9\s.,!?'-]+$/, message: 'Letters, numbers, and punctuation only.' },
            ];

            // Global error log array
            let form_errors = [];
            
            // This function validates input fields live and displays temporary messages
            // @param {Event} e - Input event from the field
            // @param {RegExp} pattern - The allowed pattern for the field
            // @param {String} message - Custom error message
            // @return {void}
            function handleInputValidation(e, pattern, message) {
                const input = e.target;
                const errorOutput = document.getElementById(input.id + '-error');
                const value = input.value;

                if (value && !pattern.test(value)) {
                    input.classList.add('flash');
                    input.setCustomValidity(message);
                    errorOutput.textContent = message;
                    fadeOut(errorOutput);
                } else {
                    input.setCustomValidity('');
                    errorOutput.textContent = '';
                }

                setTimeout(() => input.classList.remove('flash'), 500);
            }

            
            // This function fades out error messages after a short delay
            // @param {HTMLElement} element - The error message element to fade
            // @return {void}
            function fadeOut(element) {
                setTimeout(() => element.classList.add('fade-out'), 1500);
                setTimeout(() => {
                    element.textContent = '';
                    element.classList.remove('fade-out');
                }, 2500);
            }

            
            // This function handles form submission and logs all validation errors
            // @param {SubmitEvent} e - The submit event from the form
            // @return {void}
            function handleFormSubmit(e) {
                e.preventDefault();
                
                let currentErrors = []; // Errors found in THIS submission attempt

                // Validate name, email, subject (pattern + required)
                fields.forEach(({ id, pattern, message }) => {
                    const input = document.getElementById(id);
                    const errorOutput = document.getElementById(id + '-error');
                    const value = input.value.trim();

                    // Check if empty (required field)
                    if (!value) {
                        const error = {
                            field: id,
                            value: value,
                            message: 'This field is required.',
                        };
                        currentErrors.push(error);
                        errorOutput.textContent = 'This field is required.';
                        input.classList.add('flash');
                    }
                    // Check pattern if value exists
                    else if (!pattern.test(value)) {
                        const error = {
                            field: id,
                            value: value,
                            message: message,
                        };
                        currentErrors.push(error);
                        errorOutput.textContent = message;
                        input.classList.add('flash');
                    }
                });

                // Validate contact method (required)
                const contactMethod = document.getElementById('contact-method');
                const contactMethodError = document.getElementById('contact-method-error');
                if (!contactMethod.value) {
                    const error = {
                        field: 'contact-method',
                        value: '',
                        message: 'Please select a contact method.',
                    };
                    currentErrors.push(error);
                    contactMethodError.textContent = 'Please select a contact method.';
                    contactMethod.classList.add('flash');
                }

                // Validate phone (optional, but must match pattern if provided)
                const phone = document.getElementById('phone');
                const phoneError = document.getElementById('phone-error');
                const phonePattern = /^[0-9]{10}$/;
                if (phone.value && !phonePattern.test(phone.value)) {
                    const error = {
                        field: 'phone',
                        value: phone.value,
                        message: 'Enter a 10-digit number (digits only).',
                    };
                    currentErrors.push(error);
                    phoneError.textContent = 'Enter a 10-digit number (digits only).';
                    phone.classList.add('flash');
                }

                // ACCUMULATE errors into persistent array
                if (currentErrors.length > 0) {
                    // Add current errors to the persistent log
                    form_errors.push(...currentErrors);
                    
                    console.log("=== SUBMISSION ATTEMPT BLOCKED ===");
                    console.log("Errors in this attempt:", currentErrors.length);
                    console.log("Current errors:", JSON.stringify(currentErrors, null, 2));
                    console.log("Total accumulated errors:", form_errors.length);
                    console.log("All errors so far:", JSON.stringify(form_errors, null, 2));
                    
                    // Display message to user
                    const infoOutput = document.getElementById('info');
                    if (infoOutput) {
                        infoOutput.textContent = `Please fix ${currentErrors.length} error(s) before submitting.`;
                        infoOutput.style.color = 'red';
                        setTimeout(() => {
                            infoOutput.textContent = '';
                        }, 3000);
                    }
                    
                    return; // Block submission
                }

                // NO ERRORS - Prepare for successful submission
                console.log("=== FORM VALIDATION PASSED ===");
                console.log("Submitting with complete error history...");
                console.log("Total mistakes logged:", form_errors.length);
                console.log("Complete error history:", JSON.stringify(form_errors, null, 2));

                // Create or update hidden field with complete error history
                let hiddenField = document.getElementById('form-errors');
                if (!hiddenField) {
                    hiddenField = document.createElement('input');
                    hiddenField.type = 'hidden';
                    hiddenField.id = 'form-errors';
                    hiddenField.name = 'form-errors';
                    form.appendChild(hiddenField);
                }
                hiddenField.value = JSON.stringify(form_errors);

                // Submit the form with valid data + error history
                form.submit();
            }

            
            // This function updates the character counter and warns near the limit
            // @param {Event} e - Input event from the comments textarea
            // @return {void}
            function handleCommentInput(e) {
                const comments = e.target;
                const commentInfo = document.getElementById('comment-info');
                const maxLength = comments.getAttribute('maxlength');
                const remaining = maxLength - comments.value.length;

                commentInfo.textContent = `${remaining} characters remaining`;

                // Reset classes
                commentInfo.classList.remove('warn', 'error');
                comments.classList.remove('warn', 'error');

                // Apply warning or error styling near limit
                if (remaining <= 0) {
                    commentInfo.classList.add('error');
                    comments.classList.add('error');
                    comments.setCustomValidity('You have reached the maximum character limit!');
                } else {
                    comments.setCustomValidity('');
                }
            }

            
            // Event Listener Callings            
            // Bind validation listeners
            fields.forEach(({ id, pattern, message }) => {
                const input = document.getElementById(id);
                input.addEventListener('input', (e) => handleInputValidation(e, pattern, message));
            });

            // Bind form submission listener
            form.addEventListener('submit', handleFormSubmit);

            // Bind character counter listener
            const comments = document.getElementById('comments');
            comments.addEventListener('input', handleCommentInput);


            // ----------------------------------------------------            
            // DARK MODE
            // ----------------------------------------------------            
            // Initializes UI to reflect previously chosen mode.
            // @return {void}
            // ----------------------------------------------------
            const toggleBtn = document.getElementById("theme-toggle");
            const currentTheme = localStorage.getItem("theme");

            // ----------------------------------------------------
            // Loads the saved theme (if any) and applies "dark" mode.
            // Updates button text accordingly.
            // ----------------------------------------------------
            if (currentTheme === "dark") {
                document.body.classList.add("dark");
                toggleBtn.textContent = "Light Mode";
            }

            // ----------------------------------------------------
            // Toggles dark/light mode, saves preference, and updates button label.
            // @param {MouseEvent} event - Click event on the toggle button
            // @return {void}
            // ----------------------------------------------------
            toggleBtn.addEventListener("click", () => {
                document.body.classList.toggle("dark");

                // Check whether dark mode is currently active
                const isDark = document.body.classList.contains("dark");

                // ----------------------------------------------------
                // Saves the updated theme preference to localStorage.
                // Ensures theme persists across page reloads.
                // ----------------------------------------------------
                localStorage.setItem("theme", isDark ? "dark" : "light");

                // Update button label to indicate the available toggle
                toggleBtn.textContent = isDark ? "Light Mode" : "Dark Mode";
            });



        });
        </script>

		<!-- JS Disable fail safe, learned it the hard way from 110 -->
        <noscript>
            <h3>
                Hi, your JavaScript is turned off. This will affect some components of the website.<br>
                Please turn back on for the best experience ðŸ¥° - Kiet.
            </h3>
        </noscript>



        
    </body>
</html>